import{o as l,c as d,b as t,a as n,w as i,n as I,F as h,u as k,r as p,e as V,v as M,d as u,t as c,f as w,g,h as C}from"./index-9ba3883d.js";import{V as H,s as r,D as A,a as N,c as b,g as v,f,h as z}from"./VLayout-adda45de.js";import{l as B}from"./index-729d7a69.js";import{g as R,a as O}from"./connectionManager-2eeae4e5.js";import{V as T}from"./VMain-ee8a0062.js";import{V as F,a as _}from"./VRow-f18ab1bf.js";import{V as G,a as L,b as E}from"./VList-88c86c8f.js";const D={id:"appBarContainer"},j=t("h3",{style:{"margin-left":"15px"}},"Filtros",-1),U={class:"filter-container"},x=t("h3",{style:{"margin-left":"15px"}},"Selecciona un submarí",-1),$={style:{"flex-grow":"1","margin-right":"8px"}},P=t("option",{disabled:"",value:""},"Selecciona un submarí",-1),q=["value"],J=t("i",{class:"mdi mdi-close mdi-24px"},null,-1),K=[J],Q={key:0},W=t("b",null,"Nom del robot:",-1),X=t("b",null,"Estat del robot:",-1),Y=t("b",null,"Estat de la càmera:",-1),Z=t("b",null,"Última connexió:",-1),ee=t("b",null,"Temps encès:",-1),oe=t("b",null,"Rutina en curs:",-1),ie=t("h3",{style:{"margin-left":"15px"}},"Historial de moviments",-1),te={class:"scroll-container"},se={data(){return{opciones:["Home","Camino a casa","En rutina","En camino a destino","Inmersión","Ascenso","EMERGENCIA"],opcionSeleccionada:null,submarinos:[],movimientos:[],movimientoSub:[],submarinoSeleccionado:null,nombreSubmarino:"",socket:null,seleccionado:!1,combinacionesOpciones:{Inmersión:[],Ascenso:[],EMERGENCIA:[],Home:["EMERGENCIA"],"Camino a casa":["EMERGENCIA","Inmersión","Ascenso"],"En rutina":["Inmersión","Ascenso","EMERGENCIA"],"En camino a destino":["EMERGENCIA","Inmersión","Ascenso"]},opcionesSeleccionadas:[],minHeight:0,backgroundColor:"#EFEFEF"}},created(){this.getSubmarino(),this.socket=B("http://seashepherd.duckdns.org:3170/"),this.socket.on("actualizarMovimientos",async e=>{this.movimientos=e}),localStorage.getItem("motor")&&(r.motor=localStorage.getItem("motor")),localStorage.getItem("tiempoEncendido")&&(r.tiempoEncendido=localStorage.getItem("tiempoEncendido")),localStorage.getItem("camara")&&(r.camara=localStorage.getItem("camara")),localStorage.getItem("movimiento")&&(r.movimiento=localStorage.getItem("movimiento")),localStorage.getItem("ultimaConexion")&&(r.ultimaConexion=localStorage.getItem("ultimaConexion"))},mounted(){console.log("MOUNTED"),this.updateMinHeight(),window.addEventListener("resize",this.updateMinHeight)},beforeDestroy(){window.removeEventListener("resize",this.updateMinHeight)},computed:{estado(){return r.connected},motor(){return r.motor},timeON(){return r.tiempoEncendido},camara(){return r.camara},ultimaConexion(){return r.ultimaConexion},movimientosRobot(){return console.log(this.movimiento),r.movimiento}},methods:{updateMinHeight(){const e=document.getElementById("appBarContainer"),o=e?e.offsetHeight:0;this.minHeight=window.innerHeight-o},getColor(e){switch(e){case"Inmersión":return"verde-oscuro";case"Ascenso":return"verde-claro";case"En rutina":return"negro";case"Camino a casa":return"azul-oscuro";case"EMERGENCIA":return"rojo";case"Home":return"azul-claro";case"En camino a destino":return"morado";default:return""}},msToTime(e){var o=e%1e3;e=(e-o)/1e3;var a=e%60;e=(e-a)/60;var s=e%60,m=(e-s)/60;return m+":"+s+":"+a},async getSubmarino(){const o=k().getUserEmpresa;try{const a=await R(o);this.submarinos=Array.from(a)}catch(a){console.error("Error fetching submarinos:",a)}},async getMovements(){this.movimientos=await O(),console.log(this.movimientos)},avanzar(){this.seleccionado=!0,this.movimientoSub=this.movimientos.filter(e=>e.idSubmarino===this.submarinoSeleccionado.id_sub),this.opcionSeleccionada=null},limpiarSeleccion(){this.submarinoSeleccionado=null,this.movimientoSub=[],this.opcionesSeleccionadas=[],this.seleccionado=!1},toggleOpcion(e){const o=["Home","Camino a casa","En rutina","En camino a destino"],a=this.opcionesSeleccionadas.indexOf(e);this.submarinoSeleccionado!==null?(a!==-1?this.opcionesSeleccionadas.splice(a,1):(o.includes(e)&&(this.opcionesSeleccionadas=this.opcionesSeleccionadas.filter(m=>!o.includes(m))),this.opcionesSeleccionadas.filter(m=>this.combinacionesOpciones[m].includes(e)||this.combinacionesOpciones[e].includes(m)).length===0&&this.opcionesSeleccionadas.length>0?this.opcionesSeleccionadas=[e]:this.opcionesSeleccionadas.push(e)),this.actualizarMovimientos()):alert("Heu de seleccionar un submarí per poder utilitzar el filtre")},actualizarMovimientos(){this.opcionesSeleccionadas.length===0?this.movimientoSub=this.movimientos.filter(e=>e.idSubmarino===this.submarinoSeleccionado.id_sub):this.movimientoSub=this.movimientos.filter(e=>e.idSubmarino===this.submarinoSeleccionado.id_sub&&e.movimientos_sub.some(o=>this.opcionesSeleccionadas.includes(o.detalle))).map(e=>{const o=e.movimientos_sub.filter(a=>this.opcionesSeleccionadas.includes(a.detalle));return{...e,movimientos_sub:o}}).filter(e=>e.movimientos_sub.length>0)}},watch:{movimientos:{immediate:!0,handler(e){this.submarinoSeleccionado&&(this.movimientoSub=e.filter(o=>o.idSubmarino===this.submarinoSeleccionado.id_sub),console.log("Actualizado movimientoSub:",this.movimientoSub))}}}},de=Object.assign(se,{__name:"datos",setup(e){return(o,a)=>(l(),d(h,null,[t("div",D,[n(A)]),n(H,{class:"rounded rounded-md",style:I({backgroundColor:o.backgroundColor,minHeight:`${o.minHeight}px`})},{default:i(()=>[n(T,null,{default:i(()=>[n(N,{fluid:""},{default:i(()=>[n(F,null,{default:i(()=>[n(_,{cols:"2"},{default:i(()=>[n(b,{class:"filter-card",style:{"margin-top":"10px"}},{default:i(()=>[n(v,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:i(()=>[j]),_:1}),n(f,null,{default:i(()=>[t("div",U,[(l(!0),d(h,null,p(o.opciones,s=>(l(),g(z,{key:s,onClick:m=>o.toggleOpcion(s),class:C(["filtro-btn",{"btn-active":o.opcionesSeleccionadas.includes(s)}])},{default:i(()=>[u(c(s),1)]),_:2},1032,["onClick","class"]))),128))])]),_:1})]),_:1})]),_:1}),n(_,{cols:"5"},{default:i(()=>[n(b,{class:"submarino-card"},{default:i(()=>[n(v,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:i(()=>[x]),_:1}),n(f,{class:"d-flex align-center justify-space-between"},{default:i(()=>[t("div",$,[V(t("select",{class:"select","onUpdate:modelValue":a[0]||(a[0]=s=>o.submarinoSeleccionado=s),onChange:a[1]||(a[1]=(...s)=>o.avanzar&&o.avanzar(...s))},[P,(l(!0),d(h,null,p(o.submarinos,s=>(l(),d("option",{key:s.id,value:s},c(s.nom_sub),9,q))),128))],544),[[M,o.submarinoSeleccionado]])]),t("span",{class:"icon",onClick:a[2]||(a[2]=(...s)=>o.limpiarSeleccion&&o.limpiarSeleccion(...s)),style:{cursor:"pointer"}},K)]),_:1})]),_:1}),n(b,{class:"info-card"},{default:i(()=>[n(f,null,{default:i(()=>{var s;return[o.seleccionado?(l(),d("div",Q,[t("p",null,[W,u(" "+c(o.submarinoSeleccionado.nom_sub),1)]),t("p",null,[X,u(" "+c(o.motor),1)]),t("p",null,[Y,u(" "+c(o.camara),1)]),t("p",null,[Z,u(" "+c(o.ultimaConexion),1)]),t("p",null,[ee,u(" "+c(o.msToTime(o.timeON)),1)]),t("p",null,[oe,u(" "+c((s=o.movimientoSub[0])==null?void 0:s.rutina),1)])])):w("",!0)]}),_:1})]),_:1})]),_:1}),n(_,{cols:"5"},{default:i(()=>[n(b,{class:"history-card"},{default:i(()=>[n(v,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:i(()=>[ie]),_:1}),n(f,{class:"marg text-center"},{default:i(()=>[t("div",te,[n(G,null,{default:i(()=>[o.movimientoSub.length>0?(l(!0),d(h,{key:0},p(o.movimientoSub,(s,m)=>(l(),g(E,{key:m},{default:i(()=>[(l(!0),d(h,null,p(s.movimientos_sub,(S,y)=>(l(),g(E,{key:y,class:"message"},{default:i(()=>[t("span",{class:C(o.getColor(S.detalle))},c(S.fecha)+" - "+c(S.detalle),3)]),_:2},1024))),128))]),_:2},1024))),128)):(l(),g(E,{key:1},{default:i(()=>[n(L,null,{default:i(()=>[u("No hi ha moviments")]),_:1})]),_:1}))]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}});export{de as default};
