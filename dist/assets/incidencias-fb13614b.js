import{V as R,D as T,h as p,f as I,c as b,a as N,g as V,q as E}from"./VLayout-adda45de.js";import{g as B,r as O}from"./connectionManager-2eeae4e5.js";import{o as m,c as g,a as o,w as d,F as v,u as k,b as t,d as r,g as _,r as w,f as L,t as c,h as F,M as $,N as M}from"./index-9ba3883d.js";import{_ as z,l as j,e as f}from"./index-729d7a69.js";import{V as q}from"./VMain-ee8a0062.js";import{V as C}from"./VDialog-e9c9ca24.js";import{V as H,b as S,a as G,c as D}from"./VList-88c86c8f.js";import{V as A}from"./VTextField-1fb5a8e2.js";import{V as U}from"./VTextarea-1c956fcf.js";import{V as y}from"./VSelect-586de474.js";import"./VOverlay-0623f727.js";import"./VField-0d46687c.js";import"./scopeId-6d8fa96d.js";const u=a=>($("data-v-67068949"),a=a(),M(),a),J={class:"table"},K=u(()=>t("th",null,"Assumpte de la incidència",-1)),Q=u(()=>t("th",null,"Submarí",-1)),W=u(()=>t("th",null,"Autor",-1)),X=u(()=>t("th",null,"Responsable",-1)),Y=u(()=>t("th",null,"Prioritat",-1)),Z=u(()=>t("th",null,"Estat",-1)),x=u(()=>t("th",null,"Tipus",-1)),ii={style:{border:"none"}},ei={style:{border:"none","margin-left":""}},ni={style:{border:"none","margin-left":""}},ai=u(()=>t("h3",{style:{"margin-left":"15px"}},"Descripció de la incidència",-1)),oi=u(()=>t("h3",{style:{"margin-left":"15px"}},"Historial de reports de la incidència",-1)),di=u(()=>t("h3",{style:{"margin-left":"15px"}},"Crear nova incidència",-1)),ti=u(()=>t("h3",{style:{"margin-left":"15px"}},"Editar incidència",-1)),ri={computed:{incidenciasFiltradas(){let a=this.incidencias;return this.filtroPrioridad&&(a=a.filter(e=>e.prioridad===this.filtroPrioridad)),this.filtroEstado&&(a=a.filter(e=>this.filtroEstado==="acabadas"&&e.estado==="Finalizada"||this.filtroEstado==="sin_acabar"&&e.estado!=="Finalizada")),a}},data(){return{listaEnviar:[],reportes:[],reporteSeleccionado:[],incidencias:[],ordenFecha:{campo:null,direccion:null},dialogoVisible:!1,nuevaIncidencia:{nombre:"",descripcion:"",submarinoSeleccionado:null,submarino:"",autor:"",tipo:"",prioridad:"",fechaInicio:new Date().toISOString().substr(0,10)},dialogoEdicionVisible:!1,edicionIncidencia:{nombre:"",descripcion:"",prioridad:""},indiceEdicion:null,prioridades:["Alta","Media","Baja"],filtroActual:null,filtroPrioridad:null,filtroEstado:null,filtros:[{id:1,label:"Todas las incidencias",tipo:null,filtro:null},{id:2,label:"Incidencias acabadas",tipo:"estado",filtro:"acabadas"},{id:3,label:"Incidencias sin acabar",tipo:"estado",filtro:"sin_acabar"},{id:4,label:"Prioridad Alta",tipo:"prioridad",filtro:"Alta"},{id:5,label:"Prioridad Media",tipo:"prioridad",filtro:"Media"},{id:6,label:"Prioridad Baja",tipo:"prioridad",filtro:"Baja"}],mostrarFiltroCard:!1,submarinos:[],submarinoOptions:[],nomCompleto:"",descripcionVisible:null,dialogDescripcion:!1,descripcionSeleccionada:"",idIncidenciaEditando:null,dialogReport:!1,socket:null}},methods:{mostrarDialogo(){this.dialogoVisible=!0},cerrarDialogo(){this.dialogoVisible=!1},async guardarIncidencia(){const a=k(),e=a.getUserEmpresa,n=a.getUserID,i=e!==null,l=this.submarinos.find(h=>h.nom_sub===this.nuevaIncidencia.submarinoSeleccionado);if(!this.nuevaIncidencia.nombre||!this.nuevaIncidencia.descripcion||!this.nuevaIncidencia.tipo||!this.nuevaIncidencia.prioridad||!this.nuevaIncidencia.submarinoSeleccionado){alert("Tots els camps són obligatoris. Si us plau, completa la informació.");return}if(this.nuevaIncidencia.nombre.length>45){alert("El nom no pot tenir més de 45 caràcters.");return}if(this.nuevaIncidencia.descripcion.length>250){alert("La descripció no pot tenir més de 250 caràcters.");return}this.nomCompleto=a.getUserName+" "+a.getUserApellido,this.incidencias.push({Asunto:this.nuevaIncidencia.nombre,descripcion:this.nuevaIncidencia.descripcion,Autor:this.nomCompleto,tipo:this.nuevaIncidencia.tipo,prioridad:this.nuevaIncidencia.prioridad,estado:"Nueva",fecha_inicio:this.nuevaIncidencia.fechaInicio,fecha_fin:"",nom_sub:l.nom_sub});const s=a.getUserEmpresa;this.listaEnviar.push(this.nuevaIncidencia.nombre,this.nuevaIncidencia.descripcion,a.getUserID,this.nuevaIncidencia.tipo,this.nuevaIncidencia.prioridad,"Nueva",this.nuevaIncidencia.fechaInicio,l.id_sub,s);const P={listaEnviar:this.listaEnviar,hasIdEmpresa:i,id:s,idUser:n};this.socket.emit("insertarIncidencia",P,h=>{h.status===200?window.alert("Incidència inserida correctament"):window.alert("Error en inserir la incidència")}),this.socket.emit("SelectReports",s,h=>{h.status===200?window.alert("Incidència inserida correctament"):window.alert("Error en inserir la incidència")}),this.socket.on("incidenciaResult",h=>{this.incidencias=h,console.log("Incidencias para la empresa:",this.incidencias)}),this.nuevaIncidencia.nombre="",this.nuevaIncidencia.descripcion="",this.nomCompleto="",this.nuevaIncidencia.tipo="",this.nuevaIncidencia.prioridad="",this.nuevaIncidencia.submarinoSeleccionado=null,this.dialogoVisible=!1,this.listaEnviar=[]},formatearFecha(a){if(!a)return"";const e=new Date(a),n={year:"numeric",month:"numeric",day:"numeric"};return e.toLocaleDateString("es-ES",n)},toggleFiltro(){this.mostrarFiltroCard=!this.mostrarFiltroCard},esFiltroSeleccionado(a){return a.filtro===null?this.filtroPrioridad===null&&this.filtroEstado===null:a.tipo==="prioridad"&&this.filtroPrioridad===a.filtro||a.tipo==="estado"&&this.filtroEstado===a.filtro},aplicarFiltro(a){a.filtro===null?(this.filtroPrioridad=null,this.filtroEstado=null):a.tipo==="prioridad"?this.filtroPrioridad=this.filtroPrioridad!==a.filtro?a.filtro:null:a.tipo==="estado"&&(this.filtroEstado=this.filtroEstado!==a.filtro?a.filtro:null),this.filtroActual=a.filtro},ordenarPor(a){this.ordenFecha.campo===a?this.ordenFecha.direccion=this.ordenFecha.direccion==="asc"?"desc":"asc":(this.ordenFecha.campo=a,this.ordenFecha.direccion="asc"),this.incidencias.sort((e,n)=>(this.ordenFecha.direccion==="asc"?1:-1)*(new Date(e[a])-new Date(n[a])))},obtenerIconoOrden(a){return this.ordenFecha.campo===a&&this.ordenFecha.direccion==="asc"?"mdi-arrow-up":"mdi-arrow-down"},editarIncidencia(a,e){const n=this.incidenciasFiltradas[a];this.edicionIncidencia.nombre=n.Asunto,this.edicionIncidencia.descripcion=n.descripcion,this.edicionIncidencia.prioridad=n.prioridad,this.indiceEdicion=a,this.idIncidenciaEditando=e,this.dialogoEdicionVisible=!0},reportIncidencia(a){const e=this.reportes.filter(n=>n.id_incidencia===a);e.length>0?(this.reporteSeleccionado=e,console.log(this.reporteSeleccionado),this.dialogReport=!0):window.alert("No es va trobar cap report en aquesta incidència.")},async guardarEdicionIncidencia(){const e=k().getUserEmpresa;if(this.indiceEdicion!==null){if(!this.edicionIncidencia.nombre||!this.edicionIncidencia.descripcion||!this.edicionIncidencia.prioridad){alert("Tots els camps són obligatoris. Si us plau, completa la informació.");return}if(this.edicionIncidencia.nombre.length>45){alert("El nom no pot tenir més de 45 caràcters.");return}if(this.edicionIncidencia.descripcion.length>250){alert("La descripció no pot tenir més de 250 caràcters.");return}const n=this.incidenciasFiltradas[this.indiceEdicion];n.nombre=this.edicionIncidencia.nombre,n.descripcion=this.edicionIncidencia.descripcion,n.prioridad=this.edicionIncidencia.prioridad;const i=this.idIncidenciaEditando,l={nombre:n.nombre,descripcion:n.descripcion,prioridad:n.prioridad,id:i,id_empresa:e};this.socket.emit("updateIncidencia",l,s=>{s.status===200||window.alert("Error en inserir la incidència")}),this.socket.emit("SelectReports",i,s=>{s.status===200||window.alert("Error en inserir la incidència")}),this.socket.on("incidenciaResult",s=>{this.incidencias=s,console.log("Incidencias para la empresa:",this.incidencias)}),this.dialogoEdicionVisible=!1,this.edicionIncidencia.nombre="",this.edicionIncidencia.descripcion="",this.edicionIncidencia.prioridad="",this.indiceEdicion=null}},cancelarEdicion(){this.dialogoEdicionVisible=!1,this.edicionIncidencia.nombre="",this.edicionIncidencia.descripcion="",this.indiceEdicion=null},async getSubmarino(){const e=k().getUserEmpresa;try{const n=await B(e);this.submarinos=Array.from(n)}catch(n){console.error("Error fetching submarinos:",n)}},mostrarDescripcion(a){this.descripcionSeleccionada=a,this.dialogDescripcion=!0},async getReportes(){try{this.reportes=await O()}catch(a){console.error("Error fetching reportes:",a)}}},created(){this.socket=j("http://seashepherd.duckdns.org:3170/");const e=k().getUserEmpresa,n=async()=>{try{e===null||e==="null"?this.socket.on("selectIncidencia",i=>{this.incidencias=i,console.log(this.incidencias)}):(this.socket.emit("selectIncidenciaEmpresa",{idEmpresa:e}),this.socket.on("incidenciaResult",i=>{this.incidencias=i})),this.socket.on("ResultUpdateInci",i=>{const l=this.incidencias.findIndex(s=>s.id_incidencia===i.id_incidencia);l!==-1&&(this.incidencias[l].Asignado=i.asignado,this.incidencias[l].estado=i.newEstado,console.log("IF"),console.log(this.incidencias[l])),console.log("Fuera:"),console.log(this.incidencias)}),this.socket.on("ResultUpdateEstado",i=>{console.log("Actualización recibida para incidencias 2:",i);const l=this.incidencias.findIndex(s=>s.id_incidencia===i.id_incidencia);l!==-1&&(this.incidencias[l].estado=i.newEstado,this.incidencias[l].fecha_fin=i.fecha_fin,console.log("IF"),console.log(this.incidencias[l])),console.log("Fuera:"),console.log(this.incidencias)})}catch(i){console.error("Error al obtener las incidencias:",i)}};n(),n().then(()=>{console.log("CREADO"),this.getSubmarino(),this.getReportes()})},mounted(){console.log("MONTADO")},updated(){console.log("UPDATED")}},li=Object.assign(ri,{__name:"incidencias",setup(a){return(e,n)=>(m(),g(v,null,[o(T),o(R,{class:"rounded rounded-md"},{default:d(()=>[o(q,null,{default:d(()=>[t("div",null,[o(p,{class:"ml-4",style:{"margin-top":"20px"},color:"#84ACCE",onClick:e.mostrarDialogo},{default:d(()=>[r("Crear incidència")]),_:1},8,["onClick"]),o(p,{class:"ml-4",style:{"margin-top":"20px"},onClick:e.toggleFiltro,text:"",color:"#84ACCE"},{default:d(()=>[r(" Filtre "),o(f,null,{default:d(()=>[r("mdi-menu-down")]),_:1})]),_:1},8,["onClick"]),e.mostrarFiltroCard?(m(),_(b,{key:0,class:"filtro-card"},{default:d(()=>[o(I,null,{default:d(()=>[(m(!0),g(v,null,w(e.filtros,i=>(m(),_(p,{class:F(["filtro-btn",{"filtro-btn-selected":e.esFiltroSeleccionado(i)}]),key:i.id,onClick:l=>e.aplicarFiltro(i)},{default:d(()=>[r(c(i.label),1)]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1})):L("",!0),o(N,{fluid:""},{default:d(()=>[t("table",J,[t("thead",null,[t("tr",null,[K,Q,W,X,Y,Z,x,t("th",{onClick:n[0]||(n[0]=i=>e.ordenarPor("fechaInicio"))},[r(" Data d'inici "),o(f,null,{default:d(()=>[r(c(e.obtenerIconoOrden("fechaInicio")),1)]),_:1})]),t("th",{onClick:n[1]||(n[1]=i=>e.ordenarPor("fechaFin"))},[r(" Data de fi "),o(f,null,{default:d(()=>[r(c(e.obtenerIconoOrden("fechaFin")),1)]),_:1})])])]),t("tbody",null,[(m(!0),g(v,null,w(e.incidenciasFiltradas,(i,l)=>(m(),g("tr",{key:i.id_incidencia},[t("td",null,c(i.Asunto),1),t("td",null,c(i.nom_sub),1),t("td",null,c(i.Autor),1),t("td",null,c(i.Asignado),1),t("td",null,[t("div",{class:F({circle:!0,"high-priority":i.prioridad==="Alta","medium-priority":i.prioridad==="Media","low-priority":i.prioridad==="Baja"})},c(i.prioridad),3)]),t("td",null,c(i.estado),1),t("td",null,c(i.tipo),1),t("td",null,c(e.formatearFecha(i.fecha_inicio)),1),t("td",null,c(e.formatearFecha(i.fecha_fin)),1),t("td",ii,[o(f,{onClick:s=>e.mostrarDescripcion(i.descripcion)},{default:d(()=>[r("mdi-eye")]),_:2},1032,["onClick"])]),t("td",ei,[o(f,{onClick:s=>e.editarIncidencia(l,i.id_incidencia)},{default:d(()=>[r("mdi-pencil")]),_:2},1032,["onClick"])]),t("td",ni,[o(f,{onClick:s=>e.reportIncidencia(i.id_incidencia)},{default:d(()=>[r("mdi-history")]),_:2},1032,["onClick"])])]))),128))])])]),_:1})]),o(C,{modelValue:e.dialogDescripcion,"onUpdate:modelValue":n[3]||(n[3]=i=>e.dialogDescripcion=i),"max-width":"500"},{default:d(()=>[o(b,null,{default:d(()=>[o(V,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:d(()=>[ai]),_:1}),o(I,null,{default:d(()=>[r(c(e.descripcionSeleccionada),1)]),_:1}),o(E,null,{default:d(()=>[o(p,{color:"primary",onClick:n[2]||(n[2]=i=>e.dialogDescripcion=!1)},{default:d(()=>[r("Tancar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(C,{modelValue:e.dialogReport,"onUpdate:modelValue":n[5]||(n[5]=i=>e.dialogReport=i),"max-width":"500"},{default:d(()=>[o(b,null,{default:d(()=>[o(V,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:d(()=>[oi]),_:1}),o(H,null,{default:d(()=>[(m(!0),g(v,null,w(e.reporteSeleccionado,(i,l)=>(m(),_(S,{key:l},{default:d(()=>[o(S,null,{default:d(()=>[o(G,null,{default:d(()=>[r(c(i.fecha_report),1)]),_:2},1024),o(D,null,{default:d(()=>[r(c(i.mensaje),1)]),_:2},1024),o(D,null,{default:d(()=>[r(c(i.solucionado),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(E,null,{default:d(()=>[o(p,{color:"primary",onClick:n[4]||(n[4]=i=>e.dialogReport=!1)},{default:d(()=>[r("Tancar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(C,{modelValue:e.dialogoVisible,"onUpdate:modelValue":n[11]||(n[11]=i=>e.dialogoVisible=i),"max-width":"600px"},{default:d(()=>[o(b,null,{default:d(()=>[o(V,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:d(()=>[di]),_:1}),o(I,null,{default:d(()=>[o(A,{modelValue:e.nuevaIncidencia.nombre,"onUpdate:modelValue":n[6]||(n[6]=i=>e.nuevaIncidencia.nombre=i),label:"Assumpte de la incidència"},null,8,["modelValue"]),o(U,{modelValue:e.nuevaIncidencia.descripcion,"onUpdate:modelValue":n[7]||(n[7]=i=>e.nuevaIncidencia.descripcion=i),label:"Descripció de la incidència"},null,8,["modelValue"]),o(y,{modelValue:e.nuevaIncidencia.submarinoSeleccionado,"onUpdate:modelValue":n[8]||(n[8]=i=>e.nuevaIncidencia.submarinoSeleccionado=i),label:"Submarí",items:e.submarinos.map(i=>i.nom_sub),"item-text":"text","item-value":"value"},null,8,["modelValue","items"]),o(y,{modelValue:e.nuevaIncidencia.tipo,"onUpdate:modelValue":n[9]||(n[9]=i=>e.nuevaIncidencia.tipo=i),items:["Actualización software","Reparación"],label:"Tipo"},null,8,["modelValue"]),o(y,{modelValue:e.nuevaIncidencia.prioridad,"onUpdate:modelValue":n[10]||(n[10]=i=>e.nuevaIncidencia.prioridad=i),items:e.prioridades,label:"Prioridad"},null,8,["modelValue","items"])]),_:1}),o(E,null,{default:d(()=>[o(p,{color:"primary",onClick:e.guardarIncidencia},{default:d(()=>[r("Crear i desar")]),_:1},8,["onClick"]),o(p,{color:"error",onClick:e.cerrarDialogo},{default:d(()=>[r("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(C,{modelValue:e.dialogoEdicionVisible,"onUpdate:modelValue":n[15]||(n[15]=i=>e.dialogoEdicionVisible=i),"max-width":"600px"},{default:d(()=>[o(b,null,{default:d(()=>[o(V,{height:"60",style:{"background-color":"#224870",color:"white"}},{default:d(()=>[ti]),_:1}),o(I,null,{default:d(()=>[o(A,{modelValue:e.edicionIncidencia.nombre,"onUpdate:modelValue":n[12]||(n[12]=i=>e.edicionIncidencia.nombre=i),label:"Nou nom"},null,8,["modelValue"]),o(U,{modelValue:e.edicionIncidencia.descripcion,"onUpdate:modelValue":n[13]||(n[13]=i=>e.edicionIncidencia.descripcion=i),label:"Nova descripció"},null,8,["modelValue"]),o(y,{modelValue:e.edicionIncidencia.prioridad,"onUpdate:modelValue":n[14]||(n[14]=i=>e.edicionIncidencia.prioridad=i),items:e.prioridades,label:"Canviar prioritat"},null,8,["modelValue","items"])]),_:1}),o(E,null,{default:d(()=>[o(p,{color:"primary",onClick:e.guardarEdicionIncidencia},{default:d(()=>[r("Desar")]),_:1},8,["onClick"]),o(p,{color:"error",onClick:e.cancelarEdicion},{default:d(()=>[r("Cancelar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})],64))}}),ki=z(li,[["__scopeId","data-v-67068949"]]);export{ki as default};
