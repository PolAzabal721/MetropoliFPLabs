import{V as p,D as f,a as y,h as b,c}from"./VLayout-fc878ec6.js";import{C as g}from"./auto-a7dedb8f.js";import{L as n}from"./leaflet.draw-src-43f32a12.js";import{f as C}from"./connectionManager-2eeae4e5.js";import{o as E,c as _,a as r,w as o,n as h,F as S,u as v,d as s,b as w,t as A}from"./index-31b0bcf3.js";import{V as F}from"./VMain-ca383553.js";import{V as k,a as u}from"./VRow-0c2986bd.js";import{V as B}from"./VSelect-418528d4.js";import"./index-64449bee.js";import"./VList-95d5b38a.js";import"./VTextField-977154ce.js";import"./VField-b8a35a97.js";import"./VOverlay-88475a82.js";import"./scopeId-b3b08e45.js";const L={class:"d-flex align-center"},D=s("div",{id:"mapaSelect",style:{height:"650px",width:"100%"}},null,-1),V={class:"scroll-container"},j=s("h1",{class:"d-flex align-center justify-center"}," Temperatura °C ",-1),O=s("canvas",{class:"mx-auto",id:"myChart",width:"850",height:"425"},null,-1),M=["disabled"],T=s("option",{value:"hores"},"Filtrar Hores",-1),q=s("option",{value:"dies"},"Filtrar Dies",-1),z=s("option",{value:"meses"},"Filtrar Mesos",-1),I=s("option",{value:"any"},"Filtrar Anys",-1),N=[T,q,z,I],R={data(){return{drawer:!1,selectedArea:null,areas:[],areaEncontrada:null,nombreLugarBusqueda:"",backgroundColor:"#EFEFEF",areaSeleccionada:!1,isSearchActive:!1}},methods:{async getAreas(){try{const a=v().getUserEmpresa;this.areas=await C(),this.areas=this.areas.filter(t=>t.idEmpresa===a)}catch(e){console.error("Error fetching areas:",e)}},async buscarArea(){if(this.isSearchActive)this.limpiarBusqueda();else{const e=this.areas.find(a=>a.nombreArea===this.nombreLugarBusqueda);e&&e.coordenadas&&(this.cargarCoordenadasEnMapaSelect(e.coordenadas),this.areaEncontrada=e,this.areaEncontradaID=e._id,this.nombreExistente=e.nombreArea,this.areaEncontrada&&this.cargarTemperaturas(),this.isSearchActive=!0)}},limpiarBusqueda(){this.areaEncontrada=null,this.nombreLugarBusqueda="",this.isSearchActive=!1,this.limpiarMapaSelect(),this.myChart&&(this.myChart.data.labels=[],this.myChart.data.datasets.forEach(e=>{e.data=[]}),this.myChart.update()),this.initMapaSelect(),this.resetFilter()},initMapaSelect(){this.mapa=n.map("mapaSelect").setView([41.38879,2.15899],11),n.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/voyager/{z}/{x}/{y}.png",{maxZoom:18}).addTo(this.mapa);const e=new n.FeatureGroup;this.mapa.addLayer(e),this.drawControl=new n.Control.Draw({edit:{featureGroup:e,edit:!1,remove:!1},draw:{polygon:!1,circle:!1,rectangle:!1,marker:!1,polyline:!1,circlemarker:!1}}),this.mapa.addControl(this.drawControl),this.mapa.on(n.Draw.Event.CREATED,a=>{const t=a.layer;e.addLayer(t)})},cargarCoordenadasEnMapaSelect(e){this.limpiarMapaSelect(),this.initMapaSelect(),this.drawControl.addTo(this.mapa),this.dibujarAreaEnMapa(e)},dibujarAreaEnMapa(e){const a=n.geoJSON({type:"Feature",geometry:{type:"Polygon",coordinates:e}}).addTo(this.mapa);this.mapa.fitBounds(a.getBounds())},limpiarMapaSelect(){this.mapa&&(this.drawControl&&this.mapa.removeControl(this.drawControl),this.mapa.eachLayer(e=>{this.mapa.removeLayer(e)}),this.mapa.remove())},initGrafico(){this.myChart=new g(document.getElementById("myChart"),{type:"line",data:{labels:[""],datasets:[{label:"",data:[],fill:!1,borderColor:"#224870",tension:.1}]},options:{scales:{y:{beginAtZero:!0}}}})},getLabelsFromCoordinates(e,a){return Object.keys(e).map(d=>{const i=e[d].temperaturas;switch(a){case"hores":return Object.keys(i.hores);case"dies":return Object.keys(i.dies);case"meses":return Object.keys(i.meses);case"any":return Object.keys(i.any);default:return Object.keys(i.hores)}}).flat()},updateChart(e,a){document.getElementById("hour-filter").addEventListener("change",this.filterChartData.bind(this)),this.myChart.data.datasets[0].data=e,this.myChart.data.labels=a,this.myChart.update()},filterChartData(e){const a=e.target.value,t=this.areaEncontrada.temperaturas;if(a&&t)if(Object.keys(t).length>0){const l=Object.entries(t[a]).map(([i,m])=>({x:i,y:m})),d=this.getLabelsFromCoordinates({[this.selectedRoute]:{temperaturas:t}},a);this.updateChart(l,d)}else console.error("La ruta seleccionada no tiene datos válidos");else console.error("Datos de ruta no válidos")},cargarTemperaturas(){try{const e=this.areaEncontrada;if(e&&e.temperaturas&&e.temperaturas.hores){const a=e.temperaturas.hores,t=Object.keys(a);this.updateChart(Object.values(a),t)}else console.error("Datos de temperatura no válidos")}catch(e){console.error("Error al cargar temperaturas:",e)}},resetFilter(){const e=document.getElementById("hour-filter");e.selectedIndex=0},detectScreenSize(){window.innerWidth<=768?this.backgroundColor="#EFEFEF":this.backgroundColor="#EFEFEF"}},created(){console.log("CREADO"),this.getAreas(),window.addEventListener("resize",this.detectScreenSize),this.detectScreenSize()},mounted(){console.log("MONTADO"),this.$nextTick(()=>{this.detectScreenSize()}),this.initMapaSelect(),this.initGrafico()},updated(){console.log("UPDATED")},destroyed(){window.removeEventListener("resize",this.detectScreenSize)}},ae=Object.assign(R,{__name:"informes",setup(e){return(a,t)=>(E(),_(S,null,[r(f),r(p,{class:"rounded rounded-md",style:h({backgroundColor:a.backgroundColor})},{default:o(()=>[r(F,null,{default:o(()=>[r(y,{fluid:""},{default:o(()=>[r(k,null,{default:o(()=>[r(u,{cols:"6"},{default:o(()=>[s("div",L,[r(B,{id:"select-ruta",modelValue:a.nombreLugarBusqueda,"onUpdate:modelValue":t[0]||(t[0]=l=>a.nombreLugarBusqueda=l),items:a.areas.map(l=>l.nombreArea),label:"Seleccioneu l'àrea que voleu editar",disabled:a.isSearchActive,style:{color:"#224870"}},null,8,["modelValue","items","disabled"]),r(b,{class:"ml-4 elevation-2",onClick:a.buscarArea,disabled:a.nombreLugarBusqueda===""&&!a.isSearchActive,style:h({backgroundColor:a.isSearchActive?"red":"#84ACCE",color:"white"})},{default:o(()=>[w(A(a.isSearchActive?"Netejar àrea seleccionada":"Buscar àrea"),1)]),_:1},8,["onClick","disabled","style"])]),D]),_:1}),r(u,{cols:"6"},{default:o(()=>[s("div",V,[r(c,{class:"mx-auto",height:"auto",width:"900"},{default:o(()=>[r(c,{height:"525",width:"900"},{default:o(()=>[j,O,s("select",{class:"filtroBtn",id:"hour-filter",disabled:!a.areaEncontrada},N,8,M)]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["style"])],64))}});export{ae as default};
